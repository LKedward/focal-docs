
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://lkedward.github.io/focal-docs/advanced/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.9">
    
    
      
        <title>Advanced topics - Focal Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-topics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Focal Documentation" class="md-header__button md-logo" aria-label="Focal Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 17H7V7h10m4 4V9h-2V7a2 2 0 0 0-2-2h-2V3h-2v2h-2V3H9v2H7c-1.11 0-2 .89-2 2v2H3v2h2v2H3v2h2v2a2 2 0 0 0 2 2h2v2h2v-2h2v2h2v-2h2a2 2 0 0 0 2-2v-2h2v-2h-2v-2m-6 2h-2v-2h2m2-2H9v6h6V9z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Focal Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Advanced topics
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/LKedward/focal" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Focal Documentation" class="md-nav__button md-logo" aria-label="Focal Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 17H7V7h10m4 4V9h-2V7a2 2 0 0 0-2-2h-2V3h-2v2h-2V3H9v2H7c-1.11 0-2 .89-2 2v2H3v2h2v2H3v2h2v2a2 2 0 0 0 2 2h2v2h2v-2h2v2h2v-2h2a2 2 0 0 0 2-2v-2h2v-2h-2v-2m-6 2h-2v-2h2m2-2H9v6h6V9z"/></svg>

    </a>
    Focal Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/LKedward/focal" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Getting started
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Getting started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../build/" class="md-nav__link">
        Building the Focal Library
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../linking/" class="md-nav__link">
        Linking Focal Programs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        Quickstart Guide
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        User guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="User guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          User guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../memory/" class="md-nav__link">
        Managing memory
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../kernels/" class="md-nav__link">
        Working with kernels
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../events/" class="md-nav__link">
        Events and synchronisation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../profiling/" class="md-nav__link">
        Profiling OpenCL code in Focal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../errors/" class="md-nav__link">
        Errors
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Advanced topics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Advanced topics
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-sub-buffers" class="md-nav__link">
    1. Sub-buffers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-pinned-host-memory" class="md-nav__link">
    2. Pinned host memory
  </a>
  
    <nav class="md-nav" aria-label="2. Pinned host memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-allocate-pinned-memory" class="md-nav__link">
    2.1 Allocate pinned memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-deallocate-pinned-memory" class="md-nav__link">
    2.2 Deallocate pinned memory
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-local-kernel-arguments" class="md-nav__link">
    3. Local kernel arguments
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        About
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://lkedward.github.io/focal" class="md-nav__link">
        API Reference >
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-sub-buffers" class="md-nav__link">
    1. Sub-buffers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-pinned-host-memory" class="md-nav__link">
    2. Pinned host memory
  </a>
  
    <nav class="md-nav" aria-label="2. Pinned host memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-allocate-pinned-memory" class="md-nav__link">
    2.1 Allocate pinned memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-deallocate-pinned-memory" class="md-nav__link">
    2.2 Deallocate pinned memory
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-local-kernel-arguments" class="md-nav__link">
    3. Local kernel arguments
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="advanced-topics">Advanced topics</h1>
<h2 id="1-sub-buffers">1. Sub-buffers</h2>
<p>Sub-buffers are separate buffer objects that reference a single contiguous slice of an existing device buffer.
Once initialised they behave like any other device buffer object.</p>
<p><strong>Interfaces:</strong>
<div class="highlight"><pre><span></span><code><span class="k">call </span><span class="n">fclInitSubBuffer</span><span class="p">([</span><span class="n">cmdQ</span><span class="p">],</span><span class="n">untypedSubBuffer</span><span class="p">,</span><span class="n">sourceBuffer</span><span class="p">,</span><span class="n">offset</span><span class="p">,</span><span class="n">size</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="p">[</span><span class="n">profileName</span><span class="p">],[</span><span class="nb">access</span><span class="p">])</span>
<span class="k">call </span><span class="n">fclInitSubBuffer</span><span class="p">([</span><span class="n">cmdQ</span><span class="p">],</span><span class="n">typedSubBuffer</span><span class="p">,</span><span class="n">sourceBuffer</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">length</span><span class="p">,</span> <span class="p">&amp;</span>
                        <span class="p">[</span><span class="n">profileName</span><span class="p">],[</span><span class="nb">access</span><span class="p">])</span>
</code></pre></div></p>
<ul>
<li>
<p><code>cmdQ</code> (<em>optional</em>) specifies the command queue to which this buffer is associated.
All buffer operations will occur on this command queue. <code>cmdQ</code> can be omitted if the default command queue has been set.</p>
</li>
<li>
<p><code>untypedSubBuffer</code> (<code>type(fclDeviceBuffer)</code>): a general buffer object with no associated type information.</p>
</li>
<li>
<p><code>typedSubBuffer</code>: can be one of <code>type(fclDeviceInt32)</code>, <code>type(fclDeviceFloat)</code>, <code>type(fclDeviceDouble)</code>.</p>
</li>
<li>
<p><code>offset</code> (<code>integer</code>): the zero-based byte offset within the source buffer at which the sub-buffer starts.</p>
</li>
<li>
<p><code>size</code> (<code>integer</code>): the size in bytes of the sub-buffer.</p>
</li>
<li>
<p><code>start</code> (<code>integer</code>): the zero-based element offset within the source buffer at which the sub-buffer starts.</p>
</li>
<li>
<p><code>length</code> (<code>integer</code>): the number of elements in the sub-buffer.</p>
</li>
<li>
<p><code>profileName</code> (<code>character(*)</code>, <code>optional</code>): descriptive name for printing profiling information. See <a href="../profiling">profiling</a>.</p>
</li>
<li>
<p><code>access</code> (one of <code>'r'</code>, <code>'w'</code>, <code>'rw'</code>, <code>optional</code>): kernel read/write access to buffer, default <code>'rw'</code>.</p>
</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">type</span><span class="p">(</span><span class="n">fclDeviceFloat</span><span class="p">)</span> <span class="kd">::</span> <span class="n">parentFloat</span><span class="p">,</span> <span class="n">childFloat</span>
<span class="p">...</span>
<span class="k">call </span><span class="n">fclInitBuffer</span><span class="p">(</span><span class="n">parentFloat</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="k">call </span><span class="n">fclInitSubBuffer</span><span class="p">(</span><span class="n">childFloat</span><span class="p">,</span><span class="n">parentFloat</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>
<p>In this example, the <code>childFloat</code> sub-buffer references the second half of the <code>parentFloat</code> buffer which contains 10 elements in total.</p>
<p><strong>API ref:</strong>
<a href="https://lkedward.github.io/focal/interface/fclinitsubbuffer.html">fclInitSubBuffer</a></p>
<h2 id="2-pinned-host-memory">2. Pinned host memory</h2>
<p><em>Pinned</em> memory refers to non-pageable memory allocated on the host; this memory can be accessed more directly by devices
since it is guaranteed not to have been '<em>paged-out</em>' by the host operating system.
Pinned memory therefore allows for both faster host-device transfers as well as being <strong>required for asynchronous transfers</strong>.</p>
<p>Pinned memory is implemented in OpenCL using the <a href="https://www.khronos.org/registry/OpenCL/sdk/1.2/docs/man/xhtml/clEnqueueMapBuffer.html">clEnqueueMapBuffer</a> command
which maps a region of allocated '<em>host accessible</em>' memory to the host address space and returns a pointer to the host address.</p>
<h3 id="21-allocate-pinned-memory">2.1 Allocate pinned memory</h3>
<p>To use pinned host memory in Focal, simply replace a standard dynamic allocation (<em>e.g.</em> <code>allocate(hostArray(N))</code>) with the <code>fclAllocHost</code> command:</p>
<p><strong>Interfaces:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">call </span><span class="n">fclAllocHost</span><span class="p">(</span><span class="n">cmdQ</span><span class="p">,</span><span class="n">ptr</span><span class="p">,</span><span class="nb">dim</span><span class="p">)</span>
<span class="k">call </span><span class="n">fclAllocHost</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="nb">dim</span><span class="p">)</span>
</code></pre></div>
<p><code>cmdQ</code> is the command queue onto which to enqueue the OpenCL map command.
As usual, when <code>cmdQ</code> is not specified the default command queue is assumed.</p>
<p><code>ptr</code> is one of:</p>
<ul>
<li><code>real(sp), pointer, dimension(:)</code></li>
<li><code>real(dp), pointer, dimension(:)</code></li>
<li><code>integer, pointer, dimension(:)</code></li>
</ul>
<p>where <code>sp</code> and <code>dp</code> refer to single precision and double precision kinds respectively.
Note that once allocated, <code>ptr</code> can be treated as any other <code>allocatable</code> Fortran array except that it cannot be deallocated using <code>deallocate</code>.</p>
<p><code>dim</code> is the number of elements for which to allocate space for.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>fclAllocHost</code> is a blocking command: execution pauses on the host until the OpenCL map command has completed.</p>
</div>
<p><strong>Example:</strong>
Allocate a one-dimensional float array of ten elements using pinned memory on the default command queue.</p>
<div class="highlight"><pre><span></span><code><span class="kt">real</span><span class="p">,</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">pinnedArray</span><span class="p">(:)</span>
<span class="p">...</span>
<span class="k">call </span><span class="n">fclAllocHost</span><span class="p">(</span><span class="n">pinnedArray</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<p><strong>API ref:</strong>
<a href="https://lkedward.github.io/focal/interface/fclallochost.html">fclAllocHost</a></p>
<h3 id="22-deallocate-pinned-memory">2.2 Deallocate pinned memory</h3>
<p>Pinned memory is implemented using pointers and is hence not automatically freed when it goes out of scope.
Therefore it <strong>must be explicitly deallocated</strong> using <code>fclFreeHost</code> when no longer required.</p>
<p><strong>Interface:</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">call </span><span class="n">fclFreeHost</span><span class="p">(</span><span class="n">cmdq</span><span class="p">,</span><span class="n">ptr</span><span class="p">)</span>
<span class="k">call </span><span class="n">fclFreeHost</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
</code></pre></div>
<p><code>cmdQ</code> is the command queue onto which to enqueue the OpenCL unmap command.
As usual, when <code>cmdQ</code> is not specified the default command queue is assumed.</p>
<p>where <code>ptr</code> is any pointer allocated using <code>fclAllocHost</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>fclFreeHost</code> is a blocking command: execution pauses on the host until the OpenCL unmap command has completed.</p>
</div>
<p><strong>API ref:</strong>
<a href="https://lkedward.github.io/focal/interface/fclfreehost.html">fclFreeHost</a></p>
<h2 id="3-local-kernel-arguments">3. Local kernel arguments</h2>
<p>If a kernel has a local memory argument, then the functions <code>fclLocalInt32</code>, <code>fclLocalFloat</code> and <code>fclLocalDouble</code> can be used to
supply an argument with a specific dimension.
Local memory arguments don't pass data to the kernel, they act like temporary variable length arrays where the size of the array can be specified at kernel launch time.</p>
<p><strong>Example</strong></p>
<p>The following OpenCL kernel has a local memory argument as the third argument:</p>
<div class="highlight"><pre><span></span><code><span class="n">__kernel</span> <span class="kt">void</span> <span class="n">myKernel</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="n">__global</span> <span class="kt">float</span> <span class="o">*</span> <span class="n">vec</span><span class="p">,</span> <span class="n">__local</span> <span class="kt">float</span> <span class="o">*</span> <span class="n">temp</span><span class="p">){</span>
  <span class="kt">int</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">get_global_id</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">get_local_id</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">temp</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>To launch this kernel with Focal, we use:</p>
<div class="highlight"><pre><span></span><code><span class="n">myKernel</span><span class="p">%</span><span class="n">launch</span><span class="p">(</span><span class="n">nElem</span><span class="p">,</span><span class="n">deviceArray</span><span class="p">,</span> <span class="n">fclLocalFloat</span><span class="p">(</span><span class="n">localSize</span><span class="p">)</span> <span class="p">)</span>
</code></pre></div>
<p>where <code>localSize</code> specifies the size of the local argument float array.</p>
<p><strong>API ref:</strong>
<a href="https://lkedward.github.io/focal/interface/fcllocalint32.html">fclLocalInt32</a>,
<a href="https://lkedward.github.io/focal/interface/fcllocalfloat.html">fclLocalFloat</a>,
<a href="https://lkedward.github.io/focal/interface/fcllocaldouble.html">fclLocalDouble</a>,
<a href="https://lkedward.github.io/focal/type/fcllocalargument.html">fclLocalArgument</a>,</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../errors/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Errors" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Errors
            </div>
          </div>
        </a>
      
      
        
        <a href="../contributing/" class="md-footer__link md-footer__link--next" aria-label="Next: Contributing" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Contributing
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.82b56eb2.min.js"></script>
      
    
  </body>
</html>